/*
All of the code within the ZingChart software is developed and copyrighted by ZingChart, Inc., and may not be copied,
replicated, or used in any other software or application without prior permission from ZingChart. All usage must coincide with the
ZingChart End User License Agreement which can be requested by email at support@zingchart.com.

Build 2.9.7_ES6
*/
zingchart.setModule("selection-tool"),zingchart.plugins.selectionTool=zingchart.plugins.selectionTool||{},zingchart.plugins.selectionTool.freeFormType={},zingchart.plugins.selectionTool.filter={text:"",nodes:[]},zingchart.plugins.selectionTool.charts=zingchart.plugins.selectionTool.charts||{},zingchart.plugins.selectionTool.angle2D=function(e,i,t,n){var o,l;for(l=Math.atan2(i,e),o=Math.atan2(n,t)-l;o>Math.PI;)o-=2*Math.PI;for(;o<-Math.PI;)o+=2*Math.PI;return o},zingchart.plugins.selectionTool.isInsidePolygon=function(e,i,t){for(var n=0,o=[],l=[],a=e.length,c=0;c<a;c++)o[0]=e[c][0]-i,o[1]=e[c][1]-t,l[0]=e[(c+1)%a][0]-i,l[1]=e[(c+1)%a][1]-t,n+=zingchart.plugins.selectionTool.angle2D(o[0],o[1],l[0],l[1]);return Math.abs(n)>=Math.PI},zingchart.plugins.selectionTool.intersectRect=function(e,i){return!(i.iX>e.iX+e.I||i.iX+i.I<e.iX||i.iY>e.iY+e.F||i.iY+i.F<e.iY)},zingchart.plugins.selectionTool.checkAgainstFilters=function(VJ){var bValidNode=!0,sFilterText=zingchart.plugins.selectionTool.filter.text;if(""!==sFilterText){bValidNode=!1,sFilterText=sFilterText.replace(/%plot-index/gi,VJ.plotindex).replace(/%node-index/gi,VJ.index).replace(/%node-keyvalue/gi,VJ.keyvalue).replace(/%node-value/gi,VJ[ZC._[9]]);try{bValidNode=eval(sFilterText)}catch(e){bValidNode=!1}}if(!bValidNode){var aFilterNodes=zingchart.plugins.selectionTool.filter.nodes;if(aFilterNodes.length){bValidNode=!1;for(var i=0;i<aFilterNodes.length;i++)if(null!==ZC._n_(aFilterNodes[i].plotindex)&&aFilterNodes[i].plotindex===VJ.plotindex&&(null!==ZC._n_(aFilterNodes[i].index)&&aFilterNodes[i].index===VJ.index||null!==ZC._n_(aFilterNodes[i].keyvalue)&&aFilterNodes[i].keyvalue===VJ.keyvalue)){bValidNode=!0;break}}}return bValidNode},function(){var e=-1,i=-1,t=[],n="",o=null,l=!1,a=!1,c=function(o){zingchart.exec(o.id,"removeobject",{type:"shape",id:o.id+"-selection-poly"}),zingchart.exec(o.id,"removeobject",{type:"label",id:o.id+"-selection-rectangle"}),t=[],e=-1,i=-1,n=""},r=function(e,i){if(l){var t=zingchart.getLoader(e.id),n=t.MJ||t.o,o=n[ZC._[16]]?n[ZC._[16]][0]:n,a={};o["selection-tool"]&&o["selection-tool"].cursor&&(a=o["selection-tool"].cursor,ZC._todash_(a));var c={id:e.id+"-selection-cursor",type:"plus",x:e.x,y:e.y,"line-width":1,"line-color":"#cc0000",size:5,alpha:e.ev.shiftKey||e.ev.metaKey||i?1:0,flat:!0};a.label&&(c.label={anchor:"bl",alpha:e.ev.shiftKey||e.ev.metaKey||i?1:0,text:"Click to add points"}),ZC._cp_(a,c),zingchart.exec(e.id,"addobject",{type:"shape",data:c})}},d=function(e,i){l&&zingchart.exec(e.id,"updateobject",{type:"shape",id:e.id+"-selection-cursor",data:{x:e.x,y:e.y,alpha:e.ev.shiftKey||e.ev.metaKey||i?1:0,label:{alpha:e.ev.shiftKey||e.ev.metaKey||i?1:0}}})},s=function(e){a=!1,zingchart.exec(e.id,"removeobject",{type:"shape",id:e.id+"-selection-cursor"})},h=function(o){if(""!==n){var l,a,r,d,s,h,g=zingchart.getLoader(o.id),p=[],u=[],y=[],f=null,x=zingchart.exec(o.id,"getplotlength",{graphid:o.graphid});if(n="",o.ev.shiftKey||o.ev.metaKey||16===o.ev.keyCode){for(t.length>=2&&t.push([o.x,o.y]),l=0;l<x;l++)for(r=zingchart.exec(o.id,"getobjectinfo",{object:"plot",plotindex:l}),y[l]=r.xdata["append-selection"],s=zingchart.exec(o.id,"getnodelength",{graphid:o.graphid,plotindex:l}),a=0;a<s;a++)d=zingchart.exec(o.id,"getobjectinfo",{object:"node",plotindex:l,nodeindex:a}),null===ZC._n_(d)||d.xdata["ignore-selection"]||(zingchart.plugins.selectionTool.isInsidePolygon(t,d.x,d.y)||zingchart.plugins.selectionTool.isInsidePolygon(t,d.x+d.width,d.y)||zingchart.plugins.selectionTool.isInsidePolygon(t,d.x+d.width,d.y+d.height)||zingchart.plugins.selectionTool.isInsidePolygon(t,d.x,d.y+d.height))&&zingchart.plugins.selectionTool.checkAgainstFilters(d)&&(u.push(d),null===ZC._n_(p[l])&&(p[l]=[]),p[l].push(a));(f=g.F5()).poly=t,ZC.AQ.BZ("zingchart.plugins.selection-tool.mouseup",g,f)}else if(-1!==e&&-1!==i){var b,z,v,C,Z=Math.min(e,o.x),m=Math.max(e,o.x),T=Math.min(i,o.y),_=Math.max(i,o.y);if(m-Z<4||_-T<4)return;for(t=[[Z,T],[Z,_],[m,_],[m,T],[Z,T]],l=0;l<x;l++)for(r=zingchart.exec(o.id,"getobjectinfo",{object:"plot",plotindex:l}),y[l]=r.xdata["append-selection"],h=!1,-1!==ZC.AV(["vbar","hbar","vbar3d","hbar3d"],r.type)&&(h=!0),s=zingchart.exec(o.id,"getnodelength",{graphid:o.graphid,plotindex:l}),a=0;a<s;a++)d=zingchart.exec(o.id,"getobjectinfo",{object:"node",plotindex:l,nodeindex:a}),null!==ZC._n_(d)&&!d.xdata["ignore-selection"]&&d.onviewport&&(b=d.x,z=d.y,v=d.width,C=d.height,d.bounds&&(b=d.bounds[0],z=d.bounds[1],v=d.bounds[2]-d.bounds[0],C=d.bounds[3]-d.bounds[1]),(h&&zingchart.plugins.selectionTool.intersectRect({iX:Z,iY:T,I:m-Z,F:_-T},{iX:b,iY:z,I:v,F:C})||!h&&zingchart.plugins.selectionTool.isInsidePolygon(t,d.x,d.y))&&zingchart.plugins.selectionTool.checkAgainstFilters(d)&&(u.push(d),null===ZC._n_(p[l])&&(p[l]=[]),p[l].push(a)));(f=g.F5()).poly=t,ZC.AQ.BZ("zingchart.plugins.selection-tool.mouseup",g,f)}if(window.setTimeout(function(){c(o)},64),p.length>0){ZC.mobile&&(ZC.move=!1);var F=zingchart.exec(o.id,"getselection",{graphid:o.graphid});for(l=0;l<F.length;l++)if(y[l]&&F[l])for(p[l]||(p[l]=[]),a=0;a<F[l].length;a++)-1===ZC.AV(p[l],F[l][a])&&p[l].push(F[l][a]);window.setTimeout(function(){o.selection=p,o.nodes=u;var e=ZC.AQ.BZ("zingchart.plugins.selection-tool.selection",g,o,!0);(null===ZC._n_(e)||ZC._b_(e))&&zingchart.exec(o.id,"setselection",{graphid:o.graphid,selection:p})},1)}}};zingchart.bind(null,"destroy",function(e){zingchart.plugins.selectionTool.charts[e.id]&&(ZC.A5(document).unbind("keyup",g),ZC.A5(document).unbind("keydown",p),zingchart.plugins.selectionTool.charts[e.id]=null)});var g=function(e){16===e.keyCode&&null!==o&&(s(o),t.length>0&&(h(o),o=null))};ZC.A5(document).bind("keyup",g);var p=function(e){if(16===e.keyCode&&0===t.length&&null!==o){var i=zingchart.getLoader(o.id),n=zingchart.getModules(i);if(-1===ZC.AV(n,"selection-tool"))return;var l=i.MJ||i.o,c=l[ZC._[16]]?l[ZC._[16]][0]:l;zingchart.plugins.selectionTool.freeFormType[o.id]="lasso",c["selection-tool"]&&c["selection-tool"]["free-form-type"]&&(zingchart.plugins.selectionTool.freeFormType[o.id]=c["selection-tool"]["free-form-type"]),a?d(o,!0):r(o,!0)}};ZC.A5(document).bind("keydown",p),zingchart.bind(null,"dblclick",function(e){t.length>0&&null!==e&&(h(e),s(e),o=null)}),zingchart.bind(null,ZC._[47],function(l){if(o=l,-1===l.targetid.indexOf(l.graphid+"-preview")&&-1===l.targetid.indexOf(l.graphid+"-scroll")){var a=zingchart.getLoader(l.id),c=a.MJ||a.o,r=c[ZC._[16]]?c[ZC._[16]][0]:c,d=zingchart.getModules(a);if(-1!==ZC.AV(d,"selection-tool")){zingchart.plugins.selectionTool.charts[l.id]=!0,ZC.mobile||l.ev.preventDefault();var s=ZC.AQ.BZ("zingchart.plugins.selection-tool.beforeselection",a,l,!0);if(typeof s===ZC._[31]||s){var h,g={};if(r["selection-tool"]&&r["selection-tool"].mask&&(g=r["selection-tool"].mask,ZC._todash_(g)),"none"===l.target)if(l.ev.shiftKey||l.ev.metaKey)if(t.push([l.x,l.y]),h={id:l.id+"-selection-poly",type:"poly",points:t,"border-width":1,"border-color":"#000000","background-color":"#ff9900",alpha:.2,flat:!0},ZC._cp_(g,h),"lasso"===zingchart.plugins.selectionTool.freeFormType[l.id])zingchart.exec(l.id,"addobject",{type:"shape",data:h});else if(1===t.length)zingchart.exec(l.id,"addobject",{type:"shape",data:h}),zingchart.exec(l.id,"updateobject",{type:"shape",id:l.id+"-selection-cursor",data:{label:{visible:!1}}});else{var p=[].concat(t);p[p.length]=[p[0][0],p[0][1]],zingchart.exec(l.id,"updateobject",{type:"shape",id:l.id+"-selection-poly",data:{points:p}})}else-1===e&&-1===i&&(e=l.x,i=l.y,h={id:l.id+"-selection-rectangle",x:e,y:i,width:4,height:4,"border-width":1,"border-color":"#000000","background-color":"#ff9900",alpha:.2,flat:!0},ZC._cp_(g,h),zingchart.exec(l.id,"addobject",{type:"label",data:h}));n=l.id}}}}),zingchart.bind(null,ZC._[48],function(s){var h,g=zingchart.getLoader(s.id),p=zingchart.getModules(g);-1!==ZC.AV(p,"selection-tool")&&(o=s,l=!0,a?d(s):(a=!0,r(s)),s.id===n?(ZC.mobile||s.ev.preventDefault(),s.ev.shiftKey||s.ev.metaKey?"lasso"===zingchart.plugins.selectionTool.freeFormType[s.id]?t.length>0&&(t.push([s.x,s.y]),(h=[].concat(t))[h.length]=[h[0][0],h[0][1]],zingchart.exec(s.id,"updateobject",{type:"shape",id:s.id+"-selection-poly",data:{points:h}})):t.length>0&&((h=[].concat(t)).push([s.x,s.y]),h[h.length]=[h[0][0],h[0][1]],zingchart.exec(s.id,"updateobject",{type:"shape",id:s.id+"-selection-poly",data:{points:h}})):-1!==e&&-1!==i&&zingchart.exec(s.id,"updateobject",{type:"label",id:s.id+"-selection-rectangle",data:{x:Math.min(s.x,e),y:Math.min(s.y,i),width:Math.max(4,Math.abs(s.x-e)),height:Math.max(4,Math.abs(s.y-i))}})):c(s))}),zingchart.bind(null,"mouseout",function(e){l=!1,c(e),s(e)}),zingchart.bind(null,ZC._[49],function(e){e.ev.shiftKey||e.ev.metaKey?"lasso"===zingchart.plugins.selectionTool.freeFormType[e.id]&&h(e):h(e)})}();