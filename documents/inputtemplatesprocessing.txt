Общий алгоритм чтения параметров из входных шаблонов и передачи их на вычисления

1. Читаем весь файл, проверяем правильный ли он при помощи сигнатуры шапки
2. Если файл не верный - сообщаем об этом 
3. Далее проверяем каждую строку на предмет возможности проведения вычислений. Значения следующих колонок должны быть больше нуля 

+	1 in_SimpleBBCalcOnly.xlsx
		Колонки - 31 (AE), (32 (AF) - только если выбрана галочка calculate connections between schools, если не выбрана - всё равно что там)
+	2 in_ExtendedBBCalcOnly.xlsx
		Колонки - 30 (AD), (31 (AE) - только если выбрана галочка calculate connections between schools, если не выбрана - всё равно что там)
+	3 in_SimpleBBCalcLAN.xlsx
		Колонки - 37 (AK), 38 (AL), (39 (AM) - только если выбрана галочка calculate connections between schools, если не выбрана - всё равно  что там) - тут и в других случаях будет вопрос И или ИЛИ. Пока давай поставим И (в смысле если хотя бы одна из двух ячеек меньше 1, то не считаем вообще эту строку)
+	4 in_ExtendedBBCalcLAN.xlsx
		Колонки - 35 (AI), 36 (AJ), (37 (AK) - только если выбрана галочка calculate connections between schools, если не выбрана - всё равно  что там)
+	5 in_BBRBOnly.xlsx
		Колонки - 11 (K), (12 (L) - только если выбрана галочка calculate connections between schools, если не выбрана - всё равно  что там)
+	6 in_BBRBOnly.xlsx
		Колонки - 11 (K), (12 (L)  - только если выбрана галочка calculate connections between schools, если не выбрана - всё равно  что там)
+	7 in_SimpleBBRBLAN.xlsx
		Колонки - 16 (P), 17 (Q), (18 (R) - только если выбрана галочка calculate connections between schools, если не выбрана - всё равно  что там)
+	8 in_ExtendedBBRBLAN.xlsx
		Колонки - 16 (P), 17 (Q), (18 (R) - только если выбрана галочка calculate connections between schools, если не выбрана - всё равно  что там)
	9 in_SimpleLANOnly.xlsx
		Колонки - 10 (J)
	10 in_ExtendedLANOnly.xlsx
		Колонки - 10 (J)

Строчку считаем успешной если любой из флагов больше нуля
Файл считаем успешным и начинаем его расчёт если <10% ошибок 
Школы копируем в память все, независимо от того что ошибка там или нет и в выходной файл тоже все выводим, только те где были ошибки помечаем как не просчитанные
	

4. Если "хороших" строк (подлежащих вычислению) больше 10%, то ставим в очередь на вычисление. Выводим юзеру результаты импорта. Так как мы не грузим ничего в базу, то, вероятно, процедуру проверки файлов нужно будет проводить и второй раз, перед отправкой на вычисление

5. Отправка строки на вычисление (когда файл/проект добрался до своей очереди)

Сначала выбираем окружение из базы
5.1 Выбираем всё что есть из таблицы variables в матрицу в памяти 
	Не знаю стоит ли, но так как решили что Игорь добавит (вернёт) окно с выбором технологий, которые просчитывать, то тут можно сразу фильтрануть по колонке technology и выбрать только то, что входит в список + NULL. Хотя можно не заморачиваться пока и просто выбирать всё - фильтровать нужное будем на уровне вывода аутпута 
5.2. Затем обновляем матрицу в памяти значениями из region_has_variables (если есть что-то)
5.3. Затем обновляем матрицу в памяти значениями из country_has_variables (если есть что-то)
5.4. Затем обновляем матрицу в памяти значениями из project_has_variables (если есть что-то)
5.5. Затем обновляем матрицу в памяти значениями из templates_has_variables (согласно схеме из базы, некоторые переменные обновляем значениями из экселя, номера колонок уже в этой таблице для всех темплейтов)

6. Далее процедура будет немного отличаться для разных шаблонов (прописал ниже как и что)

	1 in_SimpleBBCalcOnly.xlsx
		Колонки 1 (A) - 30 (AD) просто сохраняем в память и "как есть" (один к одному) перегоняем в теже колонки в выходном темплейте SimpleBBCalcOnly.xlsx 
		Кроме того что уже будет выбрано согласно templates_has_variables  мне потребуется отсюда 11 колонок, которые соответствуют нашим 11 источникам трафика из таблицы traffic_sources (записи с 1й по 11ю)
		 18  - 1
		 19  - 2
		 20  - 3
		 21  - 4
		 22  - 5
		 23  - 6
		 24  - 7
		 25  - 8
		 26  - 9
		 27  - 10
		 28  - 11
		 Вот как раз числа отсюда нужно ложить в ту спец. матрицу, о которой мы говорили. Давай назовём её traffic
		 И пусть она выглядит так
		 1-я колонка - число устройств из экселя (одно и тоже будет дублироваться по 11 раз - сколько сервисов)
		 2-я колонка - bitrate (значение из таблицы services - колонка bitrate_low, bitrate_medium или bitrate_high выбирается в зависимости от того, что указано в колонке quality_level таблицы traffic_profiles для выбранного у тебя в системе профиля (одни и теже числа будут дублироваться для всех групп, но значения уникальные для каждого сервиса)
		 3-я колонка - intensity (значение из таблицы services - колонка intensity_low, intensity_medium или intensity_high выбирается в зависимости от того, что указано в колонке using_level таблицы profile_records для этого сочетания номера группы (traffic_sources_id) и сервиса (services_id). ВНИМАНИЕ - если NOTUSED - то ставим значение в ноль
		 4-я колонка - datavolume (значение из таблицы services - колонка datavolume_low, datavolume_medium или datavolume_high выбирается в зависимости от того, что указано в колонке using_level таблицы profile_records для этого сочетания номера группы (traffic_sources_id) и сервиса (services_id). ВНИМАНИЕ - если NOTUSED - то ставим значение в ноль
		Всего 11*11 = 121 строка и 4 колонки 
		В первых 11 значений первой колонки ложим число из 18 (R), в следующих 11 число из 19 (S) и т.д. 
		На выходе я верну одно число 

		И ещё кроме этого для случая если выбрана галочка calculate connections between schools нам понадобится значение из колонок 7 (G) и 8 (H) - но это отдельная история, там нужно будет сформировать массив опять-же (просто список школ), уже с рассчитанными Required Bandwidth, а я буду возвращать граф  
		Т.е. для этого сначала нужно просчитать все строки 
		

НОВОЕ НОВОЕ
Эту переменную мне тоже надо проставить для вычислений


Только зависеть это должно от значения поля quality_level у выбранного профиля 
Давай пока захардкодим
LOW InitialDataTraffic.LevelOfQuality = 0.05
MEDIUM InitialDataTraffic.LevelOfQuality = 0.005
HIGH InitialDataTraffic.LevelOfQuality = 0.0005



	2 in_ExtendedBBCalcOnly.xlsx
		Колонки 1 (A) - 29 (AC) просто сохраняем в память и "как есть" (один к одному) перегоняем в теже колонки в выходном темплейте ExtendedBBCalcOnly.xlsx 

		Кроме того что уже будет выбрано согласно templates_has_variables  мне потребуется отсюда 11 колонок, которые соответствуют нашим 11 источникам трафика из таблицы traffic_sources (записи с 1й по 11ю)
		 17  - 1
		 18  - 2
		 19  - 3
		 20  - 4
		 21  - 5
		 22 - 6
		 23  - 7
		 24 - 8
		 25  - 9
		 26  - 10
		 27 - 11
		
		Остальное сказанное выше в п. 1 справедливо и для этого шаблона

	3 in_SimpleBBCalcLAN.xlsx
		Колонки 1 (A) - 31 (AE) просто сохраняем в память и "как есть" (один к одному) перегоняем в теже колонки в выходном темплейте SimpleBBCalcLAN.xlsx
		Колонки 33 (AG) - 36 (AJ) перегоняем в колонки 32 (AF) - 35 (AI) - одну пропускаем 
	
		Кроме того что уже будет выбрано согласно templates_has_variables  мне потребуется отсюда 11 колонок, которые соответствуют нашим 11 источникам трафика из таблицы traffic_sources (записи с 1й по 11ю)
		 19  - 1
		 20  - 2
		 21  - 3
		 22  - 4
		 23  - 5
		 24  - 6
		 25  - 7
		 26  - 8
		 27  - 9
		 28  - 10
		 29  - 11
		
		Остальное сказанное выше в п. 1 справедливо и для этого шаблона


	4 in_ExtendedBBCalcLAN.xlsx
		Колонки 1 (A) - 34 (AH) просто сохраняем в память и "как есть" (один к одному) перегоняем в теже колонки в выходном темплейте ExtendedBBCalcLAN.xlsx 
Кроме того что уже будет выбрано согласно templates_has_variables  мне потребуется отсюда 11 колонок, которые соответствуют нашим 11 источникам трафика из таблицы traffic_sources (записи с 1й по 11ю)
		 22 - 1
		 23 - 2
		 24  - 3
		 25 - 4
		 26  - 5
		 27  - 6
		 28 - 7
		 29  - 8
		 30  - 9
		 31 - 10
		 32  - 11
		
		Остальное сказанное выше в п. 1 справедливо и для этого шаблона


	5 in_BBRBOnly.xlsx		
	6 in_BBRBOnly.xlsx

	Колонки 1 (A) - 10 (J) просто сохраняем в память и "как есть" (один к одному) перегоняем в теже колонки в выходном темплейте BBRBOnly.xlsx

	И ещё кроме этого для случая если выбрана галочка calculate connections between schools нам понадобится значение из колонок 7 (G) и 8 (H) - но это отдельная история, там нужно будет сформировать массив опять-же (просто список школ), положив туда значения из 7 (G) и 8 (H), а я буду возвращать граф  
	Тут как раз можно в любом порядке действовать - можно даже параллельно запускать будет. Но топологию я пока не допилил даже.

	7 in_SimpleBBRBLAN.xlsx

	Колонки 1 (A) - 15 (O) просто сохраняем в память и "как есть" (один к одному) перегоняем в теже колонки в выходном темплейте SimpleBBRBLAN.xlsx		

	Остальное сказанное выше в пп. 5 и 6 справедливо и для этого шаблона 

	8 in_ExtendedBBRBLAN.xlsx

	Колонки 1 (A) - 15 (O) просто сохраняем в память и "как есть" (один к одному) перегоняем в теже колонки в выходном темплейте ExtendedBBRBLAN.xlsx		

	Остальное сказанное выше в пп. 5 и 6 справедливо и для этого шаблона 
		

	9 in_SimpleLANOnly.xlsx

	Колонки 1 (A) - 9 (I) просто сохраняем в память и "как есть" (один к одному) перегоняем в теже колонки в выходном темплейте SimpleLANOnly.xlsx

	К этому кейсу не применима галочка про топологию 

	10 in_ExtendedLANOnly.xlsx

	Колонки 1 (A) - 9 (I) просто сохраняем в память и "как есть" (один к одному) перегоняем в теже колонки в выходном темплейте ExtendedLANOnly.xlsx

	К этому кейсу не применима галочка про топологию 


7. Передаём на вычисление в R

	1 in_SimpleBBCalcOnly.xlsx	  
	  METHOD2 - сюда нужна будет матрица с названием traffic (пока не реализовал её приём)
	  METHOD4 - для топологии (если выбрано, но пока не доделано)
	2 in_ExtendedBBCalcOnly.xlsx
	  METHOD2 - сюда нужна будет матрица с названием traffic (пока не реализовал её приём)
	  METHOD4 - для топологии (если выбрано, но пока не доделано)
	3 in_SimpleBBCalcLAN.xlsx
	  METHOD2 - сюда нужна будет матрица с названием traffic (пока не реализовал её приём)
	  METHOD3
	  METHOD4 - для топологии (если выбрано, но пока не доделано)
	4 in_ExtendedBBCalcLAN.xlsx
	  METHOD2 - сюда нужна будет матрица с названием traffic (пока не реализовал её приём)
	  METHOD3
	  METHOD4 - для топологии (если выбрано, но пока не доделано)
	5 in_BBRBOnly.xlsx
	6 in_BBRBOnly.xlsx
	  METHOD2 - сюда матрица трафик не нужна 
	  METHOD4 - для топологии (если выбрано, но пока не доделано)
	7 in_SimpleBBRBLAN.xlsx
	  METHOD2 - сюда матрица трафик не нужна 
	  METHOD3
	  METHOD4 - для топологии (если выбрано, но пока не доделано)
	8 in_ExtendedBBRBLAN.xlsx
	  METHOD2 - сюда матрица трафик не нужна 
	  METHOD3
	  METHOD4 - для топологии (если выбрано, но пока не доделано)
	9 in_SimpleLANOnly.xlsx
	  METHOD3
	10 in_ExtendedLANOnly.xlsx
	  METHOD3


8. Заполняем нужный аутпут темплейт 
	Я пропишу что буду возвращать в какой переменной для каждого кейса (каждый метод) и в какую ячейку что ложить, когда устаканятся темплейты вывода + там ещё много вариаций добавится
